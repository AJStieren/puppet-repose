<?xml version="1.0" encoding="UTF-8"?>
<!-- To configure Repose see: http://wiki.openrepose.org/display/REPOSE/Configuration -->
<system-model xmlns="http://docs.rackspacecloud.com/repose/system-model/v2.0">
  <repose-cluster id="<%= app_name %>">
    <nodes>
    <%- nodes.sort.each do |node| -%>
        <node id="<%= node.split[0] %>" hostname="<%= node %>" http-port="<%= port -%>"/>
    <%- end -%>
    </nodes>
    <filters>
    <%- filters.keys.sort.each do |key| -%>
      <filter <% filters[key].sort.map do |param, value| %><%= param %>="<%= value %>" <% end %>/>
    <%- end -%>
    </filters>
    <%- if ! @services.nil? %>
    <services>
    <%- services.keys.sort.each do |key| -%>
      <services <% services[key].sort.map do |param, value| %><%= param %>="<%= value %>" <% end %>/>
    <%- end -%>
    </services>
    <%- end -%>
    <destinations>
    <%- endpoints.each do |endpoint| -%>
      <endpoint <% endpoint.sort.map do |param, value| %><%= param %>="<%= value %>" <% end %>/>
    <%- end -%>
    </destinations>
  </repose-cluster>
  <%- if ! @service_cluster.nil? -%>
  <service-cluster id="<%= @service_cluster['name'] %>">
  <%- @service_cluster['nodes'].each do |endpoint| -%>
    <node id="repose_<%= endpoint.split('.')[0] -%>" hostname="<%= endpoint %>" http-port="9090"/>
  <%- end -%>
  </service-cluster>
  <%- end -%>
</system-model>

